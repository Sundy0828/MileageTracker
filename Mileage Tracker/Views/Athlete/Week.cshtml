
@{
    ViewBag.Title = "Week";
}

<h2>Add Week</h2>

<table class="table table-dark table-hover table-bordered">
    <thead>
        <tr>
            <th>Date</th>
            <th>Distance</th>
            <th>Type</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var day in ViewBag.Days)
        {
            <tr>
                <td><div id="date">@day.Date.ToString("dddd, dd MMMM")</div></td>
                <td><input id="distance" class="form-control" type="number" value="@day.Distance"/></td>
                <td>@Html.DropDownList("rtype", new SelectList(ViewBag.runTypes, "ID", "Description"), new { @class = "form-control", name = "rtype" })</td>
                <td><input id="notes" class="form-control" type="text" value="@day.Notes"/></td>
            </tr>
        }
        </tbody>
</table>

<button type="button" class="btn btn-danger" onclick="save()">Save</button>

@section scripts{
    <script>
        function save() {
            var date = document.querySelectorAll("[id^=date]");
            var dist = document.querySelectorAll("[id^=distance]");
            var time = document.querySelectorAll("[id^=time]");
            var type = document.querySelectorAll("[id^=rtype]");
            var note = document.querySelectorAll("[id^=notes]");

            var values = [];

            for (var i = 0; i < 7; i++) {
                values.push({
                    "Date": date[i].textContent,
                    "Distance": dist[i].value,
                    "Sunday": date[6].textContent,
                    "RunType": type[i].value,
                    "Notes": note[i].value
                });
                //alert(date[i].textContent + ", " + dist[i].value + ", " + time[i].value + ", " + type[i].value + ", " + note[i].value);
            }

            $.ajax({
                url: "/Athlete/UpdateWeek",
                data: { weeklyRuns : values },
                method: "POST",
                async: false,
                success: function () {
                    location.href = "/Athlete";
                },
                error: function () {
                    alert("An error occured");
                }
            });
        }
    </script>
    }